<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>感谢名单 - 花咲一秋</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- 本地 Chillax 字体优先 -->
    <link rel="stylesheet" href="fonts/Chillax_Complete/Fonts/WEB/css/chillax.css">
    <!-- 优先使用 woff2，若无则回退到 ttf；font-display:swap 提升可见性 -->
    <!-- 运行时长依赖（odometer） -->
    <link rel="stylesheet" href="https://registry.npmmirror.com/hexo-theme-redefine/2.8.5/files/source/assets/odometer-theme-minimal.css">
    <script src="https://registry.npmmirror.com/hexo-theme-redefine/2.8.5/files/source/js/build/libs/odometer.min.js"></script>
    <!-- APlayer + MetingJS -->
    <link href="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/aplayer/1.10.1/APlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <style>
        @font-face{
            font-family: 'SJ-Narrow';
            src: url('fonts/SJ-Narrow.woff2') format('woff2'), url('fonts/SJ-Narrow-Regular-2.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        @font-face{
            font-family: 'SJ-Narrow';
            src: url('fonts/SJ-Narrow-Light.woff2') format('woff2'), url('fonts/SJ-Narrow-Light-2.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
    </style>
    <style>
        /* Sync navbar and right-side tools with index.html (example.html parity)
           Preserve local link texts — only visual/positioning styles applied */
        .navbar-container {
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
            background-color: var(--card-bg);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(0,0,0,0.08);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, padding 0.3s ease, box-shadow 0.3s ease;
        }
        .navbar-container.shrink { padding: 0.25rem 0; box-shadow: 0 6px 16px rgba(0,0,0,0.06); }
        .navbar-content { display:flex; justify-content:space-between; align-items:center; padding:0.75rem 1.5rem; max-width:1200px; margin:0 auto; }
        .desktop .navbar-list { display:flex; list-style:none; gap:1.5rem; }
        .navbar-item a { display:inline-flex; align-items:center; gap:0.5rem; color:var(--text-medium); text-decoration:none; padding:0.5rem 0; transition:color 0.2s ease; }
        .navbar-item a::after { content:''; position:absolute; bottom:0; left:0; width:0; height:2px; background-color:var(--primary-blue); transition:width 0.3s ease; }
        .navbar-item a.active, .navbar-item a:hover { color:var(--primary-blue); }
        .navbar-item a.active::after, .navbar-item a:hover::after { width:100%; }
        .mobile { display:none; align-items:center; gap:1rem; }
        .icon-item { color:var(--text-medium); font-size:1.25rem; cursor:pointer; padding:0.5rem; border-radius:50%; }
        .icon-item:hover { color:var(--primary-blue); background-color: rgba(0,0,0,0.03); }
        .navbar-drawer { position:fixed; top:0; left:-100%; width:100%; max-width:320px; height:100vh; background-color:var(--card-bg); z-index:1001; transition:left 0.3s cubic-bezier(0.4,0,0.2,1); padding:2rem 1.5rem; overflow-y:auto; box-shadow:0 6px 16px rgba(0,0,0,0.06); }
        .navbar-drawer.open { left:0; }
        .drawer-navbar-list { list-style:none; display:flex; flex-direction:column; gap:0.5rem; }
        .drawer-navbar-item a { display:flex; align-items:center; justify-content:space-between; color:var(--text-medium); text-decoration:none; padding:1rem; border-radius:8px; border:1px solid transparent; }
        .drawer-navbar-item a:hover, .drawer-navbar-item a.active { color:var(--primary-blue); background-color: rgba(0,0,0,0.03); border-color: rgba(0,0,0,0.06); }
        .window-mask { position:fixed; top:0; left:0; width:100%; height:100%; background-color: rgba(0,0,0,0.3); z-index:1000; opacity:0; pointer-events:none; transition:opacity 0.3s ease; }
        .window-mask.show { opacity:1; pointer-events:all; }

        /* place tools above widget-stack and avoid overlap with bottom widgets */
        .right-side-tools-container { position: fixed; right: 18px; bottom: 120px; z-index: 11002; }
        .side-tools-container { display:flex; flex-direction:column; gap:0.75rem; }
        .right-bottom-tools { width:3rem; height:3rem; border-radius:50%; background-color: rgba(255,255,255,0.9); backdrop-filter: blur(8px); border:1px solid rgba(0,0,0,0.08); display:inline-flex; align-items:center; justify-content:center; cursor:pointer; box-shadow:0 6px 16px rgba(0,0,0,0.06); transition:transform 0.2s ease; }
        .right-bottom-tools:hover { transform:scale(1.06); color:#fff; background-color:var(--primary-blue); }
        .hidden-tools-list { display:flex; flex-direction:column; gap:0.75rem; opacity:0; transform:translateY(10px); pointer-events:none; transition:opacity 0.3s ease, transform 0.3s ease; }
        .hidden-tools-list.show { opacity:1; transform:translateY(0); pointer-events:all; }
        @media(max-width:768px){ .desktop{display:none;} .mobile{display:flex;} .right-side-tools-container{right:18px;bottom:96px;} }
    </style>
    <script>
        // 在 CSS 之前设置主题，避免初始闪烁
        (function(){
            try{
                var stored = localStorage.getItem('theme');
                var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                var use = stored || (prefersDark ? 'dark' : 'light');
                if(use === 'dark') document.documentElement.setAttribute('data-theme','dark');
            }catch(e){}
        })();
    </script>
    <script>
        // navbar scroll shrink behavior (from example.html)
        document.addEventListener('DOMContentLoaded', ()=>{
            const top = document.querySelector('.top-nav');
            const navc = document.querySelector('.navbar-container');
            function onScroll(){ const y = window.scrollY || window.pageYOffset; if(y>50){ navc && navc.classList.add('shrink'); top && top.classList.add('shrink'); } else { navc && navc.classList.remove('shrink'); top && top.classList.remove('shrink'); } }
            window.addEventListener('scroll', onScroll); onScroll();
            document.querySelectorAll('.drawer-navbar-item a').forEach(link=> link.addEventListener('click', ()=>{ const nd = document.querySelector('.navbar-drawer'); const mask = document.getElementById('windowMask'); if(nd){ nd.classList.remove('open'); mask && mask.classList.remove('show'); document.body.style.overflow=''; } }));
            const navbarBar = document.getElementById('navbarBar'); if(navbarBar){ navbarBar.addEventListener('click', ()=>{ const nd = document.querySelector('.navbar-drawer'); const mask = document.getElementById('windowMask'); if(!nd) return; if(nd.classList.contains('open')){ nd.classList.remove('open'); mask && mask.classList.remove('show'); document.body.style.overflow=''; } else { nd.classList.add('open'); mask && mask.classList.add('show'); document.body.style.overflow='hidden'; } }); }
        });
    </script>
    <style>
        /* 引入本地 SJ-Narrow 字体：Light 与 Regular */
        @font-face{
            font-family: 'SJ-Narrow';
            src: url('fonts/SJ-Narrow-Regular-2.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        @font-face{
            font-family: 'SJ-Narrow';
            src: url('fonts/SJ-Narrow-Light-2.ttf') format('truetype');
            font-weight: 300;
            font-style: normal;
            font-display: swap;
        }
        :root{
            --primary-blue: #6a93c9;
            --accent-pink: #ff7aa2;
            --mint: #2ecc71;
            --gold: #ffcc00;
            --bg: linear-gradient(180deg, #f6f8fb 0%, #eef3f9 100%);
            --main-bg: linear-gradient(180deg, #f6f8fb 0%, #eef3f9 100%);
            --section-icon-bg: linear-gradient(90deg,#fff8fb, #fff);
            --thank-bg: linear-gradient(90deg,#fff,#f7fbff);
            --card-bg: rgba(255,255,255,0.98);
            --private-bg: linear-gradient(90deg, rgba(255,255,255,0.98), rgba(250,246,255,0.98));
            --icon-bg: rgba(255, 204, 0, 0.08);
            --text: var(--text-dark);
            --heading-color: var(--text-dark);
            --muted: #6b7280;
            --text-dark: #0f1724;
            --text: #0f1724;
            --badge-bg: rgba(15,23,36,0.04);
            --member-bg: rgba(15,23,36,0.02);
            --member-border: rgba(15,23,36,0.04);
            --glass: rgba(255,255,255,0.6);
            --shadow-soft: 0 8px 30px rgba(15,23,36,0.06);
            --shadow-strong: 0 20px 50px rgba(15,23,36,0.12);
            --radius: 14px;
            --transition: 300ms cubic-bezier(.2,.9,.2,1);
        }

        /* 暗色主题覆盖（放在 :root 之后以确保覆盖默认变量） */
        :root[data-theme="dark"]{
            --primary-blue: #5a86b8;
            --accent-pink: #ff85a8;
            --mint: #27b16b;
            --gold: #f0c24a;
            --bg: linear-gradient(180deg,#07101a 0%, #04111a 100%);
            --main-bg: linear-gradient(180deg,#07101a 0%, #04111a 100%);
            --section-icon-bg: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
            --thank-bg: linear-gradient(90deg, rgba(10,12,16,0.85), rgba(14,18,26,0.9));
            --card-bg: rgba(10,14,20,0.85);
            --private-bg: rgba(12,18,26,0.7);
            --muted: #9fb0c8;
            --text-dark: #eaf3ff;
            --text: #eaf3ff;
            --badge-bg: rgba(255,255,255,0.04);
            --member-bg: rgba(255,255,255,0.03);
            --member-border: rgba(255,255,255,0.06);
            --icon-bg: rgba(255,204,0,0.05);
            --text: var(--text-dark);
            --heading-color: var(--text-dark);
            --shadow-soft: 0 10px 30px rgba(0,0,0,0.6);
            --shadow-strong: 0 30px 70px rgba(0,0,0,0.7);
        }

        /* 高对比模式 */
        :root[data-theme="high-contrast"]{
            --primary-blue: #0b5fc7;
            --accent-pink: #ff0077;
            --mint: #00a64f;
            --gold: #ffd43b;
            --bg: #ffffff;
            --main-bg: #ffffff;
            --section-icon-bg: rgba(0,0,0,0.04);
            --thank-bg: linear-gradient(90deg,#ffffff,#f7fbff);
            --card-bg: #ffffff;
            --private-bg: linear-gradient(90deg, #fff, #fff);
            --muted: #333333;
            --text-dark: #111111;
            --text: #111111;
            --badge-bg: rgba(0,0,0,0.04);
            --member-bg: rgba(0,0,0,0.02);
            --member-border: rgba(0,0,0,0.06);
            --icon-bg: rgba(0,0,0,0.04);
            --shadow-soft: 0 6px 18px rgba(0,0,0,0.08);
            --shadow-strong: 0 12px 30px rgba(0,0,0,0.12);
            --text: var(--text-dark);
            --heading-color: var(--text-dark);
        }

        /* 减少动画的全局类（与 JS 配合） */
        .reduced-motion *, .reduced-motion *::before, .reduced-motion *::after {
            animation-duration: 0.001ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.001ms !important;
            scroll-behavior: auto !important;
        }
        /* 运行时长小组件样式（固定右下） */
        .runtime-widget{ position:fixed; right:18px; bottom:18px; z-index:11001; background:var(--card-bg); padding:10px 14px; border-radius:12px; box-shadow:var(--shadow-soft); font-size:13px; color:var(--text); display:flex; gap:8px; align-items:center; }
        .runtime-widget .odometer{ font-weight:700; margin:0 6px; font-size:13px }
        .runtime-widget .runtime-label{ font-weight:700; font-size:13px }
        .runtime-widget .anniv-row .anniv-count{ font-size:16px; font-weight:800 }
        /* music + runtime stack */
        .widget-stack{ position:fixed; right:18px; bottom:18px; z-index:11001; display:flex; flex-direction:column; gap:10px; align-items:flex-end; }
        .music-widget{ width:320px; border-radius:12px; overflow:hidden; box-shadow:var(--shadow-soft); background:var(--card-bg); }
        .music-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; padding:8px 12px; cursor:pointer }
        .music-header .title{ font-weight:700; font-family:'Chillax-Semibold','Chillax-Regular',sans-serif }
        .music-body{ height:0; overflow:hidden; transition:height 360ms ease; }
        .music-body.open{ height:220px; }
        .music-body iframe{ width:100%; height:220px; border:none; display:block }
        /* 顶部右侧隐藏式音乐控制：常态收起到屏幕右侧，仅保留小 tab；悬停或点击滑出 */
        .music-handle{ position:fixed; right:18px; top:18px; width:44px; height:44px; border-radius:10px; background:var(--card-bg); display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow-soft); z-index:11002; cursor:pointer; }
        .music-handle i{ font-size:18px; color:var(--primary-blue); }
        .music-widget{ position:fixed; right:18px; top:72px; width:320px; border-radius:12px; overflow:hidden; box-shadow:var(--shadow-soft); background:var(--card-bg); z-index:11001; transform: translateX(calc(100% - 48px)); transition:transform 320ms cubic-bezier(.2,.9,.2,1); }
        .music-handle:hover + .music-widget, .music-widget.show, .music-widget:hover{ transform: translateX(0); }
        .music-body{ height:0; overflow:hidden; transition:height 320ms ease }
        .music-body.open{ height:220px }
        .music-popup{ position:fixed; right:22px; top:72px; z-index:11003; background:var(--card-bg); padding:10px 12px; border-radius:10px; box-shadow:0 12px 30px rgba(0,0,0,0.12); display:none; min-width:240px }
        .music-popup.show{ display:block }
        .pop{ animation: pop 420ms cubic-bezier(.2,.9,.2,1); }
        @keyframes pop{ 0%{transform:scale(1)}50%{transform:scale(1.12)}100%{transform:scale(1)} }
        .fw-container{ position:absolute; inset:auto 0 auto 0; pointer-events:none; z-index:12000; width:100%; height:0; }
        .confetti{ position:absolute; width:8px; height:16px; border-radius:2px; opacity:0; transform-origin:center; }
        html,body{height:100%;}
        body{margin:0;padding:0;font-family:'Chillax-Variable','Chillax-Regular','Poppins','Noto Sans SC', sans-serif;background:var(--bg);color:var(--text-dark);-webkit-font-smoothing:antialiased}
        /* 强制 Chillax 字体用于主文案，保留 icon 字体 */
        body, h1, h2, h3, h4, h5, h6, p, a, span, div, li, input, textarea, select, button { font-family: 'Chillax-Variable','Chillax-Regular', sans-serif !important; }
        .fa, .fas, .far, .fab, i[class^="fa"], span[class^="fa"] { font-family: 'Font Awesome 6 Free', 'Font Awesome 5 Free', sans-serif !important; font-weight: 900 !important; }

        .content-wrapper{max-width:1180px;margin:28px auto;padding:22px}

        /* 顶部导航 */
        .top-nav{display:flex;justify-content:space-between;align-items:center;padding:10px 18px;background:var(--card-bg);border-radius:12px;box-shadow:var(--shadow-soft);margin-bottom:20px}
        .top-nav a{color:var(--muted);text-decoration:none;font-weight:600;margin-left:14px}
        .top-nav a:hover{color:var(--primary-blue)}
        .nav-toggle{background:transparent;border:none;padding:6px 10px;border-radius:8px;cursor:pointer;color:var(--muted);font-size:18px}
        .nav-toggle:hover{background:rgba(255,255,255,0.03);color:var(--text-dark);transform:translateY(-2px)}

        header{display:flex;align-items:center;justify-content:space-between;gap:16px}
        header h1{font-size:1.6rem;margin:0;color:var(--text-dark)}
        .note{color:var(--muted);font-size:0.95rem}

        .section-title{display:flex;align-items:center;gap:12px;margin:22px 0 12px;font-size:1.2rem;color:var(--text)}
        .section-title i{color:var(--accent-pink);background:var(--section-icon-bg);width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow-soft)}

        /* 布局：每行仅一个卡片（全宽），卡片内部成员以行内网格展示 */
        .features-grid{display:grid;grid-template-columns:1fr;gap:24px;margin-top:18px}

        .feature-card{background:var(--card-bg);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow-soft);transition:transform var(--transition),box-shadow var(--transition);position:relative;overflow:hidden;opacity:0;transform:translateY(12px)}
        .feature-card.in-view{animation:cardIn 420ms cubic-bezier(.2,.9,.2,1) forwards;animation-delay:var(--i,0ms)}
        .feature-card::after{content:'';position:absolute;inset:0;pointer-events:none;mix-blend-mode:overlay;opacity:0}
        .feature-card:hover{transform:translateY(-10px) scale(1.01);box-shadow:var(--shadow-strong)}

        @keyframes cardIn{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}

        /* role accents */
        .feature-card.supporter{border-top:6px solid var(--primary-blue)}
        .feature-card.developer{border-top:6px solid var(--mint)}
        .feature-card.sponsor{border-top:6px solid var(--gold)}

        .feature-card .icon{width:64px;height:64px;border-radius:14px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;font-size:22px;background:var(--icon-bg)}
        .feature-card .title-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
        /* 使用 SJ-Narrow（若可用）作为标题字体 */
        .feature-card h4{font-family:'SJ-Narrow', 'Poppins', 'Noto Sans SC', sans-serif;font-size:1.45rem;color:var(--heading-color);margin:0 0 12px;font-weight:700}
        .feature-card .group-sub{color:var(--muted);font-size:0.95rem}

        .group-badge{background:var(--badge-bg);color:var(--muted);padding:6px 8px;border-radius:10px;font-size:0.85rem}

        /* 成员显示为行内网格，可多列显示 */
        .members-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;margin-top:12px}
        .member-card{display:flex;align-items:center;gap:12px;padding:12px;background:var(--member-bg);border-radius:10px}
        .member-name{font-family:'SJ-Narrow','Poppins',sans-serif;font-size:1.12rem;color:var(--text);font-weight:700}
        .member-card{transition:transform 260ms cubic-bezier(.2,.9,.2,1),box-shadow 260ms}
        .member-card:hover{transform:translateY(-6px);box-shadow:0 10px 30px rgba(15,23,36,0.06)}
        .avatar{width:56px;height:56px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#fff,#f3f6fb);color:var(--primary-blue);font-weight:700;font-size:1rem}
        .avatar-img{width:56px;height:56px;border-radius:12px;object-fit:cover;border:1px solid var(--member-border)}
        .avatar-wrap{width:56px;height:56px;display:inline-flex;align-items:center;justify-content:center}
        .member-role{font-size:0.9rem;color:var(--muted)}

        /* private users card styling */
        .feature-card.private{background:var(--private-bg)}

        @media(max-width:720px){.features-grid{grid-template-columns:1fr}}
        @media(max-width:420px){.features-grid{grid-template-columns:1fr;padding:0}}
    </style>
</head>
<body>
    <!-- 装饰性浮动控件：回到顶部 & 脉冲心 -->
    <button id="back-to-top" title="回到顶部" style="display:none;">↑</button>
    <div id="floating-heart" aria-hidden="true"></div>
    <div class="content-wrapper">
        <header class="navbar-container" id="navbarContainer">
            <div class="navbar-content transition-navbar has-home-banner">
                <div class="left">
                    <a class="logo-title" href="index.html">
                        <h1>花咲一秋</h1>
                    </a>
                </div>
                <div class="right">
                    <div class="desktop">
                        <ul class="navbar-list">
                            <li class="navbar-item"><a href="index.html"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li>
                            <li class="navbar-item"><a href="Documents.html"><i class="fa-regular fa-archive fa-fw"></i> 帮助手册</a></li>
                            <li class="navbar-item"><a class="active" href="Thanks.html"><i class="fa-regular fa-hand-holding-heart fa-fw"></i> 感谢名单</a></li>
                            <li class="navbar-item"><a href="index.html#changelog"><i class="fa-regular fa-chart-bar fa-fw"></i> 更新日志</a></li>
                        </ul>
                    </div>
                    <div class="mobile">
                        <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                        <div class="icon-item navbar-bar" id="navbarBar"><i class="fa-solid fa-bars"></i></div>
                    </div>
                </div>
            </div>
            <div class="navbar-drawer" id="navbarDrawer">
                <ul class="drawer-navbar-list">
                    <li class="drawer-navbar-item"><a href="index.html"><span>首页</span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li>
                    <li class="drawer-navbar-item"><a href="Documents.html"><span>帮助手册</span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li>
                    <li class="drawer-navbar-item"><a class="active" href="Thanks.html"><span>感谢名单</span><i class="fa-regular fa-hand-holding-heart fa-sm fa-fw"></i></a></li>
                    <li class="drawer-navbar-item"><a href="index.html#changelog"><span>更新日志</span><i class="fa-regular fa-chart-bar fa-sm fa-fw"></i></a></li>
                </ul>
            </div>
            <div class="window-mask" id="windowMask"></div>
        </header>

        <header>
            <h1>感谢名单</h1>
            <p class="note">以下按类型分区，支持者按组别展示为卡片形式，感谢每一位的支持！</p>
        </header>

        <main id="thanks-container">
            <p class="note">正在加载名单</p>
        </main>
    </div>

    <script>
        // 小工具：防止注入
        function escapeHtml(str){
            return String(str).replace(/[&<>\"']/g, function(m){
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":"&#39;"})[m];
            });
        }

        function buildGroupCard(name,members,opts={}){
            // opts: { role: 'supporter'|'developer'|'sponsor', groupId: string, isPrivate: boolean }
            const card = document.createElement('div');
            const role = opts.role || '';
            card.className = 'feature-card ' + (opts.isPrivate ? 'private ' : '') + (role ? role : '');
            // 支持基于 opts.delay 设置入场延迟（例如 '120ms'）
            if(opts && opts.delay){ card.style.setProperty('--i', opts.delay); }

            // icon block
            const iconWrap = document.createElement('div'); iconWrap.className='icon';
            const ico = document.createElement('i');
            if(opts.isPrivate){ ico.className='fas fa-user'; }
            else if(role==='developer'){ ico.className='fas fa-code-branch'; }
            else if(role==='sponsor'){ ico.className='fas fa-hand-holding-dollar'; }
            else { ico.className='fas fa-user-friends'; }
            iconWrap.appendChild(ico);

            // title row
            const titleRow = document.createElement('div'); titleRow.className='title-row';
            const title = document.createElement('h4'); title.innerText = name || (opts.isPrivate ? '私聊用户' : '组别');
            titleRow.appendChild(title);

            if(opts.groupId){
                const badge = document.createElement('div'); badge.className='group-badge'; badge.textContent = '群号: ' + opts.groupId;
                titleRow.appendChild(badge);
            }

            card.appendChild(iconWrap);
            card.appendChild(titleRow);

            // 成员使用网格显示，卡片高度随成员数量自适应
            const membersGrid = document.createElement('div'); membersGrid.className = 'members-grid';
            if(Array.isArray(members) && members.length>0){
                members.forEach(m=>{
                    const mcard = document.createElement('div'); mcard.className='member-card';
                    const initials = (m && m.name) ? m.name.split(' ').map(s=>s[0]).join('').slice(0,2) : '?';
                    const avatarWrap = document.createElement('span'); avatarWrap.className='avatar-wrap';
                    if(m && m.avatar && m.avatar.toString().trim() !== ''){
                        const img = document.createElement('img'); img.className='avatar-img'; img.src = 'pictures/' + m.avatar; img.alt = m.name || '';
                        img.onerror = function(){ try{ avatarWrap.removeChild(img); }catch(e){}; const initialsSpan = document.createElement('span'); initialsSpan.className='avatar'; initialsSpan.textContent = initials; avatarWrap.appendChild(initialsSpan); };
                        avatarWrap.appendChild(img);
                    } else { const initialsSpan = document.createElement('span'); initialsSpan.className='avatar'; initialsSpan.textContent = initials; avatarWrap.appendChild(initialsSpan); }

                    const info = document.createElement('div');
                    const nameEl = document.createElement('div'); nameEl.className='member-name'; nameEl.textContent = m && m.name ? m.name : JSON.stringify(m);
                    const roleEl = document.createElement('div'); roleEl.className='member-role'; roleEl.textContent = m && m.role ? m.role : '';
                    info.appendChild(nameEl); if(roleEl.textContent) info.appendChild(roleEl);

                    mcard.appendChild(avatarWrap);
                    mcard.appendChild(info);
                    membersGrid.appendChild(mcard);
                });
            } else {
                const none = document.createElement('div'); none.className='member-card'; none.textContent = '无成员信息'; membersGrid.appendChild(none);
            }
            card.appendChild(membersGrid);
            return card;
        }

        async function loadContributors(){
            const container = document.getElementById('thanks-container');
            container.innerHTML = '';
            try{
                const res = await fetch('Contributor-list.json', {cache: 'no-store'});
                if(!res.ok) throw new Error('HTTP '+res.status);
                const data = await res.json();
                if(!Array.isArray(data)) throw new Error('JSON 格式不是数组');

                let cardIndex = 0;
                data.forEach(typeObj=>{
                    const section = document.createElement('section');
                    section.className = 'thanks-section';
                    const title = document.createElement('div');
                    title.className = 'section-title';
                    title.innerHTML = `<i class='fas fa-hand-holding-heart'></i> ${escapeHtml(typeObj.type || typeObj.name || '感谢')}`;
                    section.appendChild(title);

                    const grid = document.createElement('div'); grid.className = 'features-grid';

                        // 特殊处理 supporters：显示 groups，每个 group 显示 name 和 group_id，另外展示 private_users
                        const t = (typeObj.type || '').toString().toLowerCase();
                        if(t === 'supporters'){
                            if(typeObj.groups && Array.isArray(typeObj.groups)){
                                typeObj.groups.forEach(g=>{
                                    const delay = (cardIndex++ * 80) + 'ms';
                                    grid.appendChild(buildGroupCard(g.name || '组别', g.members || [], {role: 'supporter', groupId: g.group_id, delay}));
                                });
                            }
                            // private_users 为平级列表，直接列出成员
                            if(typeObj.private_users && Array.isArray(typeObj.private_users)){
                                // create a dedicated card for private users
                                const delay = (cardIndex++ * 80) + 'ms';
                                grid.appendChild(buildGroupCard('私聊用户', typeObj.private_users, {role: 'supporter', isPrivate: true, delay}));
                            }
                        } else if(t === 'developers' || t === 'developer'){
                            // 开发者：把整个成员列表放在一个卡片内
                            if(typeObj.members && Array.isArray(typeObj.members)){
                                const delay = (cardIndex++ * 80) + 'ms';
                                grid.appendChild(buildGroupCard(typeObj.name || '开发人员', typeObj.members, {role: 'developer', delay}));
                            }
                        } else if(t === 'sponsors' || t === 'sponsor'){
                            if(typeObj.members && Array.isArray(typeObj.members)){
                                const delay = (cardIndex++ * 80) + 'ms';
                                grid.appendChild(buildGroupCard(typeObj.name || '赞助者', typeObj.members, {role: 'sponsor', delay}));
                            }
                        } else {
                            // 兜底：按原样渲染
                            if(typeObj.groups && Array.isArray(typeObj.groups)){
                                    typeObj.groups.forEach(g=>{
                                        const delay = (cardIndex++ * 80) + 'ms';
                                        grid.appendChild(buildGroupCard(g.name || '组别', g.members || [], {delay}));
                                    });
                                } else if(typeObj.members && Array.isArray(typeObj.members)){
                                    const groupName = typeObj.name || (typeObj.type ? typeObj.type + ' 成员' : '成员');
                                    const delay = (cardIndex++ * 80) + 'ms';
                                    grid.appendChild(buildGroupCard(groupName, typeObj.members, {delay}));
                            } else if(typeObj.name && typeObj.members===undefined && typeObj.groups===undefined){
                                    const delay = (cardIndex++ * 80) + 'ms';
                                    grid.appendChild(buildGroupCard(typeObj.name, typeObj.members || [], {delay}));
                            }
                        }

                    section.appendChild(grid);
                    container.appendChild(section);
                });

            }catch(e){
                console.error(e);
                container.innerHTML = `<p class="note">加载失败：${escapeHtml(e.message || e)}</p>`;
            }
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            loadContributors();
            // 使用 IntersectionObserver 来触发卡片入场动画，提升性能
            (function(){
                const observer = new IntersectionObserver((entries)=>{
                    entries.forEach(e=>{
                        if(e.isIntersecting){
                            e.target.classList.add('in-view');
                            observer.unobserve(e.target);
                        }
                    })
                },{threshold:0.12});
                // 延迟绑定，等待卡片被插入
                const attach = ()=>{ const cards = document.querySelectorAll('.feature-card'); if(cards.length){ cards.forEach(c=>observer.observe(c)); } else setTimeout(attach, 120); };
                attach();
            })();
            // 主题切换初始化（Thanks 页面）
            (function(){
                const toggle = document.getElementById('theme-toggle');
                if(!toggle) return;
                const root = document.documentElement;
                const stored = localStorage.getItem('theme');
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                const initTheme = stored || (prefersDark ? 'dark' : 'light');
                function applyThemeFromPref(pref){
                    if(!pref || pref === 'auto'){
                        const sys = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                        root.setAttribute('data-theme', sys);
                    } else {
                        root.setAttribute('data-theme', pref);
                    }
                }
                applyThemeFromPref(initTheme === 'auto' ? null : initTheme);
                function updateIcon(){
                    const t = root.getAttribute('data-theme');
                    if(t === 'dark') toggle.innerHTML = '<i class="fas fa-sun"></i>';
                    else if(t === 'high-contrast') toggle.innerHTML = '<i class="fas fa-adjust"></i>';
                    else toggle.innerHTML = '<i class="fas fa-moon"></i>';
                }
                toggle.addEventListener('click', ()=>{
                    const cur = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                    root.setAttribute('data-theme', cur);
                    localStorage.setItem('theme', cur);
                    updateIcon();
                });
                const contrastBtn = document.getElementById('contrast-toggle');
                if(contrastBtn){
                    function updateContrastBtn(){
                        const cur = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
                        if(cur === 'high-contrast'){ contrastBtn.innerHTML = '<i class="fas fa-adjust"></i>'; contrastBtn.setAttribute('aria-pressed','true'); }
                        else { contrastBtn.innerHTML = '<i class="fas fa-eye"></i>'; contrastBtn.setAttribute('aria-pressed','false'); }
                    }
                    contrastBtn.addEventListener('click', ()=>{
                        const current = localStorage.getItem('theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark':'light');
                        const next = current === 'high-contrast' ? 'auto' : 'high-contrast';
                        if(next === 'auto') localStorage.removeItem('theme'); else localStorage.setItem('theme', next);
                        applyThemeFromPref(localStorage.getItem('theme') || null);
                        updateIcon();
                        updateContrastBtn();
                    });
                    updateContrastBtn();
                }
                const motionBtn = document.getElementById('motion-toggle');
                function applyMotionPref(){
                    const storedM = localStorage.getItem('reduceMotion');
                    if(storedM === '1') document.documentElement.classList.add('reduced-motion');
                    else if(storedM === '0') document.documentElement.classList.remove('reduced-motion');
                    else {
                        if(window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) document.documentElement.classList.add('reduced-motion');
                    }
                }
                if(motionBtn){
                    function updateMotionBtn(){
                        const cur = localStorage.getItem('reduceMotion');
                        if(cur === '1' || (cur === null && window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches)){
                            motionBtn.innerHTML = '<i class="fas fa-ban"></i>';
                            motionBtn.setAttribute('aria-pressed','true');
                        } else {
                            motionBtn.innerHTML = '<i class="fas fa-bolt"></i>';
                            motionBtn.setAttribute('aria-pressed','false');
                        }
                    }
                    motionBtn.addEventListener('click', ()=>{
                        const cur = localStorage.getItem('reduceMotion');
                        if(cur === '1'){ localStorage.setItem('reduceMotion','0'); } else { localStorage.setItem('reduceMotion','1'); }
                        applyMotionPref();
                        updateMotionBtn();
                    });
                    updateMotionBtn();
                }
                applyMotionPref();
                updateIcon();
            })();
        });
    </script>
    <!-- 右下工具栏（迁移自 example.html） -->
    <div class="right-side-tools-container">
        <div class="side-tools-container">
            <ul class="hidden-tools-list" id="hiddenToolsList">
                <li class="right-bottom-tools tool-font-adjust-plus" title="放大字体"><i class="fa-regular fa-magnifying-glass-plus"></i></li>
                <li class="right-bottom-tools tool-font-adjust-minus" title="缩小字体"><i class="fa-regular fa-magnifying-glass-minus"></i></li>
                <li class="right-bottom-tools tool-dark-light-toggle" title="切换明暗主题"><i class="fa-regular fa-moon" id="themeIcon"></i></li>
                <li class="right-bottom-tools tool-scroll-to-bottom" title="滚动到底部"><i class="fa-regular fa-arrow-down"></i></li>
            </ul>
            <ul class="visible-tools-list">
                <li class="right-bottom-tools toggle-tools-list" title="展开/收起工具" id="toggleToolsBtn"><i class="fa-regular fa-cog fa-spin" id="gearIcon"></i></li>
                <li class="right-bottom-tools tool-scroll-to-top" title="回到顶部" id="scrollToTopBtn"><i class="arrow-up fas fa-arrow-up"></i><span class="percent" id="scrollPercent">0%</span></li>
            </ul>
        </div>
    </div>

    <!-- 右下堆栈控件：音乐播放器 + 运行时长小组件 -->
    <div class="widget-stack" aria-hidden="false">
        <!-- 顶部 handle + 隐藏式音乐播放器 -->
        <div class="music-handle" id="musicHandle" role="button" title="音乐播放器" aria-label="音乐播放器控制">
            <i class="fa fa-music" aria-hidden="true"></i>
        </div>
        <div class="music-widget" id="musicWidget" aria-label="音乐播放器">
            <div class="music-header" id="musicToggle" role="button" aria-expanded="false">
                <div style="display:flex;align-items:center;gap:10px">
                    <i class="fa fa-music" aria-hidden="true"></i>
                    <div class="title">音乐播放器</div>
                </div>
                <div style="font-size:12px;color:var(--muted)">悬停展开或点击控制</div>
            </div>
            <div class="music-body" id="musicBody">
                <meting-js server="netease" type="playlist" id="2639364381"></meting-js>
            </div>
        </div>

        <div class="runtime-widget" role="note" aria-label="花咲一秋项目运行与周年进度">
            <div class="anniv-row">
                <div style="display:flex;align-items:center">
                    <div class="anniv-label">Anniversary</div>
                    <div id="anniv-count" class="anniv-count">0</div>
                </div>
                <div id="anniv-percent" style="font-size:14px;color:var(--muted);font-weight:700">0%</div>
            </div>
            <div class="progress-track" aria-hidden="true">
                <div id="anniv-fill" class="progress-fill" style="width:0%"></div>
                <div class="progress-overlay">
                    <div style="display:flex;align-items:center;gap:8px">
                        <span class="runtime-label">运行：</span>
                        <span id="runtime_days" class="odometer">0</span>
                        <span class="runtime-label">d</span>
                        <span id="runtime_hours" class="odometer">0</span>
                        <span class="runtime-label">h</span>
                        <span id="runtime_minutes" class="odometer">0</span>
                        <span class="runtime-label">m</span>
                        <span id="runtime_seconds" class="odometer">0</span>
                        <span class="runtime-label">s</span>
                    </div>
                </div>
            </div>
            <div class="fw-container" id="fw"></div>
        </div>
    </div>

    <script>
        // 运行时长 + 周年脚本（Thanks 页面）
        (function(){
            const blogStartDate = new Date(2025,9,28,0,0,0);
            let lastAnnivCount = null;
            function odometer_init(){ document.querySelectorAll('.odometer').forEach(e=>{ try{ new Odometer({ el: e, format: '(ddd)', duration: 200 }); }catch(err){} }); }
            function animateNumber(el){ if(!el) return; el.classList.remove('pop'); void el.offsetWidth; el.classList.add('pop'); setTimeout(()=>el.classList.remove('pop'),600); }
            function playFireworks(){ const container = document.getElementById('fw'); if(!container) return; const colors=['#ff5e7f','#ffd166','#8fd3ff','#9be28f','#d6a4ff']; for(let i=0;i<16;i++){ const n=document.createElement('div'); n.className='confetti'; n.style.left=(20+Math.random()*280)+'px'; n.style.top=(8+Math.random()*30)+'px'; n.style.background=colors[Math.floor(Math.random()*colors.length)]; n.style.opacity='1'; const dur=800+Math.floor(Math.random()*600); n.style.transition=`transform ${dur}ms cubic-bezier(.2,.8,.2,1), opacity ${dur}ms linear`; container.appendChild(n); setTimeout(()=>{ const tx=(Math.random()*160-80)+'px'; n.style.transform=`translate(${tx},${120+Math.random()*40}px) rotate(${Math.random()*720}deg)`; n.style.opacity='0'; },10+Math.random()*80); setTimeout(()=>{ try{ container.removeChild(n);}catch(e){} }, dur+220); } }
            function updateRuntimeAndAnniv(){
                const now = new Date();
                const diff = now - blogStartDate;
                const seconds = Math.floor((diff/1000)%60);
                const minutes = Math.floor((diff/(1000*60))%60);
                const hours = Math.floor((diff/(1000*60*60))%24);
                const days = Math.floor(diff/(1000*60*60*24));
                const d = document.getElementById('runtime_days');
                const h = document.getElementById('runtime_hours');
                const m = document.getElementById('runtime_minutes');
                const s = document.getElementById('runtime_seconds');
                if(d && String(d.innerText) !== String(days)){ d.innerText = days; animateNumber(d); }
                if(h && String(h.innerText) !== String(hours)){ h.innerText = hours; animateNumber(h); }
                if(m && String(m.innerText) !== String(minutes)){ m.innerText = minutes; animateNumber(m); }
                if(s && String(s.innerText) !== String(seconds)){ s.innerText = seconds; animateNumber(s); }

                const start = new Date(blogStartDate.getTime());
                let years = now.getFullYear() - start.getFullYear();
                let last = new Date(start.getTime()); last.setFullYear(start.getFullYear() + years);
                if(now < last){ years -= 1; last.setFullYear(start.getFullYear() + years); }
                const next = new Date(last.getTime()); next.setFullYear(last.getFullYear() + 1);
                const annivCount = Math.max(0, years);
                const annivEl = document.getElementById('anniv-count');
                if(annivEl && String(annivEl.textContent) !== String(annivCount)){ annivEl.textContent = annivCount; animateNumber(annivEl); }

                const fillEl = document.getElementById('anniv-fill');
                if(fillEl){
                    const total = next - last;
                    const elapsed = now - last;
                    const pct = total > 0 ? Math.max(0, Math.min(1, elapsed/total)) : 0;
                    fillEl.style.width = (pct*100) + '%';
                    const colors = ['#6a93c9','#ffcc66','#8fd3ff','#ff99cc','#9be28f','#d6a4ff'];
                    fillEl.style.background = colors[annivCount % colors.length];
                    // 更新百分比保留两位小数
                    const pctEl = document.getElementById('anniv-percent'); if(pctEl) pctEl.textContent = (pct*100).toFixed(2) + '%';
                }

                if(lastAnnivCount === null) lastAnnivCount = annivCount;
                else if(annivCount > lastAnnivCount){ playFireworks(); lastAnnivCount = annivCount; }
                else { lastAnnivCount = annivCount; }
            }
            document.addEventListener('DOMContentLoaded', ()=>{
                odometer_init(); updateRuntimeAndAnniv(); setInterval(updateRuntimeAndAnniv, 1000);
                const musicToggle = document.getElementById('musicToggle'); const musicBody = document.getElementById('musicBody'); if(musicToggle && musicBody){ musicToggle.addEventListener('click', ()=>{ const open = musicBody.classList.toggle('open'); musicToggle.setAttribute('aria-expanded', open ? 'true' : 'false'); }); }
                // handle 点击切换
                const musicHandle = document.getElementById('musicHandle'); if(musicHandle){ musicHandle.addEventListener('click', ()=>{ const body = document.getElementById('musicBody'); if(!body) return; const open = body.classList.toggle('open'); musicHandle.setAttribute('aria-expanded', open ? 'true' : 'false'); }); }
                // Meting/APlayer：右上滑入卡片 + 首次随机自动播放（音量 15%） + 切歌弹窗
                (function initMetingPlayer(){
                    const FLAG = 'hanasaki_music_autoplay_v1';
                    const metingEl = document.querySelector('meting-js');
                    if(!metingEl) return;
                    function escapeHtmlLocal(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
                    function showMusicPopup(track){ if(!track) return; const title = track.name || track.title || '未知曲目'; const artist = (track.artist && (typeof track.artist==='string'?track.artist: Array.isArray(track.artist)? track.artist.map(a=>a.name||a).join(', '): JSON.stringify(track.artist))) || track.author || ''; const popup = document.getElementById('musicPopup') || (function(){ const p=document.createElement('div'); p.id='musicPopup'; p.className='music-popup'; document.body.appendChild(p); return p; })(); popup.innerHTML = `<div style="font-weight:700;margin-bottom:6px">即将播放：${escapeHtmlLocal(title)}</div><div style="font-size:13px;color:var(--muted)">${escapeHtmlLocal(artist||'未知')}</div>`; popup.classList.add('show'); setTimeout(()=>{ popup.classList.remove('show'); const widget = document.querySelector('.music-widget'); if(widget) widget.classList.remove('show'); try{ const m = document.querySelector('meting-js'); const a = m && (m.aplayer||m._aplayer|| (window.APlayer && window.APlayer.instances && window.APlayer.instances[0])); if(a && typeof a.play==='function') a.play(); }catch(e){} },3000); }
                    function whenAPlayerReady(cb){ const a = metingEl.aplayer || metingEl._aplayer || (window.APlayer && window.APlayer.instances && window.APlayer.instances[0]); if(!a) return setTimeout(()=>whenAPlayerReady(cb),200); if(!a.list || a.list.length===0) return setTimeout(()=>whenAPlayerReady(cb),200); cb(a); }
                    whenAPlayerReady((a)=>{
                        try{ if(typeof a.setVolume === 'function') a.setVolume(0.15); else if(typeof a.volume === 'function') a.volume(0.15); else if(a.audio) a.audio.volume = 0.15; }catch(e){}
                        try{ if(typeof a.on === 'function'){ a.on('play', ()=>{ try{ const idx = a.index || 0; const t = (a.list && a.list[idx]) || {}; const widget = document.querySelector('.music-widget'); if(widget) widget.classList.add('show'); showMusicPopup(t); }catch(e){} }); } }catch(e){}
                        try{ if(!localStorage.getItem(FLAG)){ const count = a.list.length || 1; const rnd = Math.floor(Math.random()*count); try{ a.index = rnd; }catch(e){} try{ if(typeof a.switch === 'function') a.switch(rnd); }catch(e){} try{ a.play(); }catch(e){} const t = (a.list && a.list[rnd]) || {}; const widget = document.querySelector('.music-widget'); if(widget) widget.classList.add('show'); showMusicPopup(t); localStorage.setItem(FLAG,'1'); } }catch(e){}
                        const handle = document.getElementById('musicHandle'); const widget = document.getElementById('musicWidget'); const body = document.getElementById('musicBody'); if(handle && widget){ handle.addEventListener('click', ()=>{ widget.classList.toggle('show'); if(body) body.classList.toggle('open'); handle.setAttribute('aria-expanded', widget.classList.contains('show')); }); }
                    });
                })();
            });
        })();
    </script>
    <!-- 大型感谢区 -->
    <section style="max-width:1180px;margin:40px auto 80px;padding:40px 22px;text-align:center;">
        <div style="background:var(--thank-bg);border-radius:14px;padding:40px 30px;box-shadow:0 20px 40px rgba(15,23,36,0.08);">
            <h2 style="font-family:'SJ-Narrow','Poppins',sans-serif;font-size:48px;margin:0;color:var(--text-dark);letter-spacing:2px;">AND, THANK YOU</h2>
            <p style="font-size:20px;color:var(--muted);margin-top:12px;">感谢您的支持和参与</p>
        </div>
    </section>
</body>
</html>
